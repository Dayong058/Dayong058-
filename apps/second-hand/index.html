html
<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>äºŒæ‰‹ä¹°å–å¸‚åœº | èšåˆç½‘æ’ä»¶</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.2.0/swiper-bundle.min.css">
  <style>
    /* âœ… å‘å¸ƒæˆåŠŸå®šä½é«˜äº®ï¼šå¡ç‰‡é—ªä¸€ä¸‹ */
    .item-card.flash,
    .items-grid>div.flash {
      outline: 2px solid rgba(255, 107, 107, .55);
      box-shadow: 0 0 0 8px rgba(255, 107, 107, .16), 0 24px 60px rgba(17, 24, 39, .18);
      transform: translateY(-2px) scale(1.01);
      transition: transform 220ms cubic-bezier(.2, .8, .2, 1), box-shadow 220ms cubic-bezier(.2, .8, .2, 1);
      animation: flashPulse 900ms cubic-bezier(.2, .8, .2, 1) 1;
    }

    @keyframes flashPulse {
      0% {
        filter: brightness(1);
      }

      35% {
        filter: brightness(1.07);
      }

      100% {
        filter: brightness(1);
      }
    }

    button,
    .entry-card,
    .item-card {
      -webkit-tap-highlight-color: transparent;
    }
  </style>
</head>

<body>
  <!-- ä¸»å®¹å™¨ - é€‚é…èšåˆç½‘ -->
  <div class="market-container" id="marketApp">
    <!-- é¡¶éƒ¨æ¨å¹¿åŒº / å¹¿å‘Šä½ -->
    <div class="ad-hero" id="adHero">
      <div class="ad-swiper" id="adSwiper">
        <!-- JS åŠ¨æ€æ³¨å…¥å¹¿å‘Š -->
      </div>
      <div class="ad-dots" id="adDots"></div>
    </div>

    <!-- é¡¶éƒ¨è½®æ’­ -->
    <div class="swiper-container">
      <div class="swiper-wrapper">
        <div class="swiper-slide" style="background: linear-gradient(135deg, #FF6B6B, #FF8E53);">
          <div class="slide-content">
            <h3>è½»æ¾ä¹°å–</h3>
            <p>å‘å¸ƒé—²ç½®ï¼Œå‘ç°å®è´</p>
          </div>
        </div>
        <div class="swiper-slide" style="background: linear-gradient(135deg, #4ECDC4, #44A08D);">
          <div class="slide-content">
            <h3>å®‰å…¨ä¿éšœ</h3>
            <p>è¯šä¿¡äº¤æ˜“ï¼Œæ”¾å¿ƒä¹°å–</p>
          </div>
        </div>
        <div class="swiper-slide" style="background: linear-gradient(135deg, #FFD166, #FFB347);">
          <div class="slide-content">
            <h3>æœ¬åœ°äº¤æ˜“</h3>
            <p>åŒåŸè§é¢ï¼Œå¿«é€Ÿæˆäº¤</p>
          </div>
        </div>
      </div>
      <div class="swiper-pagination"></div>
    </div>

    <!-- ç§»åŠ¨ç«¯å…¥å£å¡ç‰‡ï¼ˆäº¤é”™å¸ƒå±€ï¼‰ -->
    <div class="mobile-entry-cards stagger">
      <div class="entry-card left" onclick="openPublishModal('sell')">
        <div class="entry-icon" style="background:#FF6B6B;">
          <i class="fas fa-upload"></i>
        </div>
        <h4>æˆ‘è¦å‡ºæ‰‹</h4>
        <p>å‘å¸ƒé—²ç½®ç‰©å“</p>
      </div>

      <div class="entry-card right" onclick="openPublishModal('buy')">
        <div class="entry-icon" style="background:#4ECDC4;">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h4>æˆ‘è¦æ·˜å®</h4>
        <p>å¯»æ‰¾å¿ƒä»ªå®è´</p>
      </div>

      <!-- ç»Ÿè®¡å°å¡ç‰‡ï¼ˆæ›¿æ¢åŸâ€œæˆ‘æ¥æºœè¾¾â€ï¼‰ -->
      <div class="entry-card left stats-card" onclick="showSection('browse')">
        <div class="stats-grid">
          <div class="stat-row">
            <span class="stat-ico">âœ…</span>
            <span class="stat-k">ä»Šæ—¥ç­¾åˆ°</span>
            <span class="stat-v" id="statSign">123</span><span class="stat-u">äºº</span>
          </div>
          <div class="stat-row">
            <span class="stat-ico">ğŸ‘€</span>
            <span class="stat-k">æµè§ˆé‡</span>
            <span class="stat-v" id="statViews">1234</span><span class="stat-u">æ¬¡</span>
          </div>
          <div class="stat-row">
            <span class="stat-ico">ğŸŸ¢</span>
            <span class="stat-k">åœ¨çº¿äººæ•°</span>
            <span class="stat-v" id="statOnline">12345</span><span class="stat-u">ä½</span>
          </div>
        </div>
      </div>
    </div>

    <!-- æœç´¢åŒºåŸŸ -->
    <div class="search-section">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="searchInput" placeholder="æœç´¢å•†å“åç§°æˆ–æè¿°...">
        <button onclick="performSearch()">æœç´¢</button>
        <button type="button" onclick="openPublishModal('sell')" style="margin-left:8px;">å‘å¸ƒ</button>
      </div>

      <div class="filter-options">
        <select id="categoryFilter">
          <option value="">æ‰€æœ‰åˆ†ç±»</option>
        </select>

        <div class="price-range">
          <input type="number" id="minPrice" placeholder="æœ€ä½ä»·">
          <span>è‡³</span>
          <input type="number" id="maxPrice" placeholder="æœ€é«˜ä»·">
        </div>

        <input type="text" id="locationFilter" placeholder="ä½ç½®">

        <select id="typeFilter">
          <option value="">å…¨éƒ¨ç±»å‹</option>
          <option value="sell">å‡ºå”®</option>
          <option value="buy">æ±‚è´­</option>
        </select>
      </div>
    </div>

    <!-- å•†å“ç½‘æ ¼ -->
    <div class="items-grid" id="itemsGrid">
      <!-- å•†å“å¡ç‰‡å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
    </div>

    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
      <button class="nav-btn active" onclick="showSection('home')">
        <i class="fas fa-home"></i>
        <span>é¦–é¡µ</span>
      </button>
      <button class="nav-btn" onclick="showSection('favorites')">
        <i class="fas fa-heart"></i>
        <span>æ”¶è—</span>
      </button>
      <button class="nav-btn" onclick="showSection('chat')">
        <i class="fas fa-comments"></i>
        <span>å®¢æœ</span>
      </button>
      <button class="nav-btn" onclick="showSection('profile')">
        <i class="fas fa-user"></i>
        <span>æˆ‘çš„</span>
      </button>
    </div>

    <!-- å•†å“è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="itemModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closeModal()">&times;</button>

        <div class="modal-header">
          <span class="item-type sell-tag" id="modalTypeTag">å‡ºå”®</span>
          <h2 id="modalTitle"></h2>
          <div class="item-price" id="modalPrice"></div>
        </div>

        <div class="image-gallery">
          <div class="main-image">
            <img id="modalMainImage" src="" alt="å•†å“ä¸»å›¾">
          </div>
          <div class="thumbnail-grid" id="thumbnailGrid"></div>
        </div>

        <div class="item-details">
          <div class="detail-row">
            <span class="detail-label">å•†å“ID:</span>
            <span class="detail-value" id="modalId"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">å‘å¸ƒæ—¶é—´:</span>
            <span class="detail-value" id="modalTime"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">å•†å“åç§°:</span>
            <span class="detail-value" id="modalTitle2"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">ä»·ã€€ã€€æ ¼:</span>
            <span class="detail-value" id="modalPrice2"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">äº¤æ˜“æ–¹å¼:</span>
            <span class="detail-value" id="modalTransaction"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">æˆã€€ã€€è‰²:</span>
            <span class="detail-value" id="modalCondition"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">ä½ã€€ã€€ç½®:</span>
            <span class="detail-value" id="modalLocation"></span>
          </div>
          <div class="detail-row">
            <span class="detail-label">æã€€ã€€è¿°:</span>
            <p class="item-description" id="modalDescription"></p>
          </div>
        </div>

        <div class="modal-actions">
          <button class="contact-btn" onclick="contactSeller()">
            <i class="fas fa-comment"></i> è”ç³»å–å®¶
          </button>
          <button class="favorite-btn" onclick="toggleFavorite()">
            <i class="far fa-heart"></i> æ”¶è—
          </button>
        </div>
      </div>
    </div>

    <!-- å‘å¸ƒå•†å“æ¨¡æ€æ¡† -->
    <div class="modal" id="publishModal">
      <div class="modal-content">
        <button class="close-modal" onclick="closePublishModal()">&times;</button>
        <h2>å‘å¸ƒå•†å“</h2>

        <form id="publishForm" enctype="multipart/form-data">
          <div class="form-group">
            <label>ç±»å‹ *</label>
            <div class="type-selector">
              <label class="type-option">
                <input type="radio" name="type" value="sell" checked>
                <span>æˆ‘è¦å‡ºå”®</span>
              </label>
              <label class="type-option">
                <input type="radio" name="type" value="buy">
                <span>æˆ‘è¦è´­ä¹°</span>
              </label>
            </div>
          </div>

          <div class="form-group">
            <label>å•†å“æ ‡é¢˜ *</label>
            <input type="text" name="title" required maxlength="50">
          </div>

          <div class="form-group">
            <label>ä»·æ ¼ (å…ƒ) *</label>
            <input type="number" name="price" step="0.01" required>
          </div>

          <div class="form-group">
            <label>åˆ†ç±» *</label>
            <select name="category" required>
              <option value="">è¯·é€‰æ‹©åˆ†ç±»</option>
            </select>
          </div>

          <div class="form-group">
            <label>æˆè‰²</label>
            <select name="condition">
              <option value="å…¨æ–°">å…¨æ–°</option>
              <option value="å‡ ä¹å…¨æ–°">å‡ ä¹å…¨æ–°</option>
              <option value="è½»å¾®ä½¿ç”¨">è½»å¾®ä½¿ç”¨</option>
              <option value="æ˜æ˜¾ä½¿ç”¨">æ˜æ˜¾ä½¿ç”¨</option>
              <option value="éœ€è¦ç»´ä¿®">éœ€è¦ç»´ä¿®</option>
            </select>
          </div>

          <div class="form-group">
            <label>äº¤æ˜“æ–¹å¼</label>
            <select name="transactionType">
              <option value="é¢äº¤">é¢äº¤</option>
              <option value="é‚®å¯„">é‚®å¯„</option>
              <option value="å‡å¯">å‡å¯</option>
            </select>
          </div>

          <div class="form-group">
            <label>ä½ç½® *</label>
            <input type="text" name="location" required>
          </div>

          <div class="form-group">
            <label>è¯¦ç»†æè¿° *</label>
            <textarea name="description" rows="4" required maxlength="500"></textarea>
          </div>

          <div class="form-group">
            <label>ä¸Šä¼ å›¾ç‰‡ (æœ€å¤š9å¼ )</label>
            <input type="file" name="images" accept="image/*" multiple>
            <small class="help-text">ç¬¬ä¸€å¼ å°†ä½œä¸ºå°é¢å›¾</small>
          </div>

          <div class="form-group">
            <label>ä¸Šä¼ è§†é¢‘ (å¯é€‰ï¼Œæœ€é•¿15ç§’)</label>
            <input type="file" name="video" accept="video/*">
            <small class="help-text">æ”¯æŒMP4æ ¼å¼ï¼Œæœ€å¤§10MB</small>
          </div>

          <div class="form-group">
            <label>Telegram ID</label>
            <input type="text" name="telegramId" id="telegramIdInput" placeholder="å°†è‡ªåŠ¨è¯†åˆ«æ‚¨çš„Telegram ID">
          </div>

          <div class="form-actions">
            <button type="button" class="btn-secondary" onclick="closePublishModal()">å–æ¶ˆ</button>
            <button type="submit" class="btn-primary">å‘å¸ƒå•†å“</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- è„šæœ¬å¼•å…¥ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/9.2.0/swiper-bundle.min.js"></script>
  <script src="js/main.js"></script>
</body>

</html>

<!-- åœ¨èšåˆç½‘é¡µé¢ä¸­æ·»åŠ  -->
<div id="market-container"></div>

<script>
  // åŠ¨æ€åŠ è½½äºŒæ‰‹å¸‚åœºæ’ä»¶
  function loadMarketPlugin() {
    const container = document.getElementById('market-container');
    container.innerHTML = `
        <iframe
            src="/second-hand/index.html?tgid=${window.Telegram?.WebApp?.initDataUnsafe?.user?.id || ''}"
            style="width: 100%; height: 600px; border: none; border-radius: 15px;"
            allow="camera; microphone"
        ></iframe>
    `;
  }

  // æˆ–è€…ç›´æ¥è·³è½¬
  function openMarketInTelegram() {
    if (window.Telegram?.WebApp) {
      Telegram.WebApp.openLink('/second-hand/index.html');
    } else {
      window.open('/second-hand/index.html', '_blank');
    }
  }

  function getTgid() {
    const u = new URL(location.href);
    const qid = u.searchParams.get("tgid");
    if (qid) return qid;
    return window.Telegram?.WebApp?.initDataUnsafe?.user?.id || "";
  }
  function goPublish(type) {
    const tgid = getTgid();
    const target = type === 'buy' ? '/second-hand/publish-buy.html' : '/second-hand/publish-sell.html';
    location.href = `${target}?tgid=${encodeURIComponent(tgid)}`;
  }
</script>
