<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <title>äºŒæ‰‹å¸‚åœºç®¡ç†åå°</title>
  <style>
    /* ç®€æ´çš„ç®¡ç†åå°æ ·å¼ */
    .admin-container {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    .admin-table {
      background: white;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    th,
    td {
      padding: 15px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }

    th {
      background: #f8f9fa;
      font-weight: 600;
    }
  </style>
</head>

<body>
  <div class="admin-container">
    <h1>äºŒæ‰‹å¸‚åœºç®¡ç†åå°</h1>
    <div class="stats-grid">
      <div class="stat-card">
        <h3>æ€»å•†å“æ•°</h3>
        <p id="totalItems">0</p>
      </div>
      <div class="stat-card">
        <h3>ä»Šæ—¥æ–°å¢</h3>
        <p id="todayItems">0</p>
      </div>
      <div class="stat-card">
        <h3>æ€»ç”¨æˆ·æ•°</h3>
        <p id="totalUsers">0</p>
      </div>
      <div class="stat-card">
        <h3>å¾…å®¡æ ¸</h3>
        <p id="pendingItems">0</p>
      </div>
    </div>

    <div class="admin-table">
      <h2>å•†å“ç®¡ç†</h2>
      <table id="itemsTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>æ ‡é¢˜</th>
            <th>ä»·æ ¼</th>
            <th>ç±»å‹</th>
            <th>å‘å¸ƒæ—¶é—´</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div class="admin-table" style="margin-top: 30px;">
      <h2>åˆ†ç±»ç®¡ç†</h2>
      <div style="padding: 20px;">
        <form id="addCategoryForm">
          <input type="text" name="name" placeholder="åˆ†ç±»åç§°" required>
          <input type="color" name="color" value="#118AB2">
          <input type="text" name="icon" placeholder="å›¾æ ‡emoji" value="ğŸ“¦">
          <button type="submit">æ·»åŠ åˆ†ç±»</button>
        </form>
      </div>
      <table id="categoriesTable">
        <thead>
          <tr>
            <th>ID</th>
            <th>åç§°</th>
            <th>é¢œè‰²</th>
            <th>å›¾æ ‡</th>
            <th>æ“ä½œ</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    // åå°ç®¡ç†é€»è¾‘
    async function loadAdminData() {
      try {
        const [items, users, categories] = await Promise.all([
          fetch('/api/items?all=true').then(r => r.json()),
          fetch('/api/users').then(r => r.json()),
          fetch('/api/categories').then(r => r.json())
        ]);

        // æ›´æ–°ç»Ÿè®¡
        document.getElementById('totalItems').textContent = items.length;
        document.getElementById('totalUsers').textContent = users.length;

        // å¡«å……è¡¨æ ¼
        populateItemsTable(items);
        populateCategoriesTable(categories);
      } catch (error) {
        console.error('åŠ è½½ç®¡ç†æ•°æ®å¤±è´¥:', error);
      }
    }

    function populateItemsTable(items) {
      const tbody = document.querySelector('#itemsTable tbody');
      tbody.innerHTML = '';

      items.forEach(item => {
        const row = document.createElement('tr');
        row.innerHTML = `
                    <td>${item.id.substring(0, 8)}...</td>
                    <td>${item.title}</td>
                    <td>Â¥${item.price}</td>
                    <td><span class="${item.type === 'sell' ? 'sell-tag' : 'buy-tag'}">${item.type === 'sell' ? 'å‡ºå”®' : 'æ±‚è´­'}</span></td>
                    <td>${new Date(item.createdAt).toLocaleDateString()}</td>
                    <td>
                        <button onclick="editItem('${item.id}')">ç¼–è¾‘</button>
                        <button onclick="deleteItem('${item.id}')" style="color: #ff6b6b;">åˆ é™¤</button>
                    </td>
                `;
        tbody.appendChild(row);
      });
    }

    // åˆå§‹åŒ–
    loadAdminData();
  </script>
</body>

</html>
